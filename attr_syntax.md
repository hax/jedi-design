# 为什么不用 Jade 的属性语法 `element(attr1=value, attr2, ...)`，而要采用 `@attr` 的写法？

attribute 的语法其实我反复考虑和纠结过。像 script 和 style 要加上 ! 也是由于 attribute 的设计原则导致的。

Jade 的方式：
```jade
E(attr1=xxx, attr2=xxx ...)
```

就我个人体会，这个语法的主要缺点有：

0. 单行时属性间必须用逗号分割，对于习惯手写 HTML 代码的人来说常常会忘记。这一点与 Jade 的其他语法设计相当不同 —— Jade 在大多数地方都是针对 HTML 语法做减法。少写东西比较容易适应，而多写东西就比较难适应。而且从书写连贯性来说，通常我会写一大段 Jade 代码再刷新页面看效果，而这导致逗号一漏通常会漏好多好多，一个一个去补是一件很令人抓狂的事情。

0. 多行时可以不用逗号。但这导致我在调整多行到一行时往往漏掉逗号。从一行调整到多行时我又忍不住去删除逗号（这种代码洁癖估计不止我一个人有）。由代码变化而反复调整所带来的繁琐和因此多出的 debug 导致的烦躁感，对我的心理产生了严重刺激 —— 这并不是说笑，因为我对代码排版格式也是比较讲究的，而 Jade 的这处设计增大了我调整代码格式的成本（这种成本比想象的大，参考下一点）。尤其是 Jade 的其他语法设计都很简洁，这更反过来凸显了这个缺陷。

0. 属性以括号包裹，如前所述，我常常忘记括号。更准确的说，起始括号通常不会忘记，【但它存在另一问题，就是括号前如果有空格就不作为属性，而是变成了文本，这个问题后续还会提到。】但是结束括号往往容易忘记，尤其在复制黏贴一段属性并一个一个加逗号时，加到最后忘记结束括号了。而 Jade 的语法决定了闭合括号的缺失并不会在该点报错！后续的元素会被作为属性被解析，直到最后无法匹配到结束括号的那个 token！这对于调试来说非常痛苦。
其实这个问题相信 Jade 社区自己也注意到了，因此后来的版本在这点上有一些改进。

然而即使对上述问题做部分改进，有一个重要的考虑，即归根到底，Jade 的属性语法其实是在整个基于缩进的语法中开了一个口子，attribute 的部分其实并不遵循 offside-rule，而是基于括号的匹配。这导致在一些 edge case 上，parse 的结果可能会和程序员的预期相悖。

缩进语法的很大好处之一就是取消了定界符，因此可以做到语法上的简洁。但是现在留了一个例外，其实就必然会造成这里描述的问题，这是一个几乎无法调和的矛盾。

因此，考虑再三后我决心必须保持缩进语法的一致性，也就是不会为属性设置任何定界符。在此基础上，我考虑过三种可能的语法方案：

一种是类 CSS 的方式：
```
a
    [href='/home'][rel='nofollow']
    [target='_blank']
```
另一种就是现在用`@`作为属性前缀的方案。
`@attr`这是 XML 社区的习惯，也是许多原生支持 XML 的语言里表达 XML 属性的语法，如 XPath、E4X（JavaScript 的 XML 原生支持扩展）等。

还有一种是独立的缩进级别：
```
a
  :attributes
    href='/home'
    rel='nofollow'
```
我考虑下来，`[attr]`语法比`@attr`并没有什么额外优点，且输入比较繁琐。而独立缩进也没有提供什么特别好处，尤其是其实许多情况下属性写在与元素同一行更方便。

因此最终我选择了现在的方式，即用`@`前缀，然后每个属性可以写在单独一行上，也支持与元素名同一行的紧凑写法。可以自由调整单行或多行格式。


【更新】
Jedi 1.0.0-rc3 开始加入 literal 属性语法

```jedi
input @@ name=user-email type=email required
```
如上示例，使得写全静态的属性与 HTML 代码完全一致。后续版本将强制普通属性的数据绑定必须每个都单独一行，确保代码清晰。
