# 为什么需要 external 指令？

之所以需要声明 external 出于两个原因。

首先，不进行声明，对于 `isset(x)`，jedi 的 PHP 编译器无法区分是 `$data->isset($x)` 还是 `isset($x)` ，尽管我们从来不写前者，但是并没有理由去禁止这种可能 —— 尤其是考虑有交互或表单的页面，模型上直接给方法如 `model.action()` 也许正是合理的设计。另外，如果不加声明，对于 `Category.load`，编译器也无法区分 `$data->Category->load` 还是 `Category::load`。

其次，从代码质量、可测试性等角度出发，view 所能访问的所有东西应该是受控的，也就是只有 $data 上所提供的东西。从这点出发，要求明确声明外部函数其实是用代码将该 view 的相关因素固定下来。之前一次 review，有同学提到过这个会造成对外部 PHP 的代码依赖，有可能在变更外部代码时产生 bug。然而这个事情只要你用了外部 PHP 函数，是总会发生的。那么明确声明这种依赖，反而提供了检查的可能，是工具友好的。

而要根本上解决这个问题，就要丰富 Jedi 语言本身的内建特性。这其实很早跟也讨论过 —— 应用架构目标中其实有一条是希望 controller 做薄，而要做薄 controller，就是在 model 和 view 两个方面要增强，减小 controller 的负担。model 方面的增强依靠更有力的查询 API 来达到，而 view 方面的增强需要靠模板语言本身表达式必须加强。但这件事情有许多细节需要推敲，有待未来进一步推进。

总之，明确的 external 声明只是把对 PHP 过多的外部依赖这个问题显式的列在那里，这至少把问题列到了明处。长期来说，只要 Jedi  的内置特性和表达式进行增强，需要 external 的东西会越来越少，基本上只有极少的个案会用到。

BTW，当前的 external 存在两个小问题是有待改进的：
一个是按照设计目标 external 应该在整个模板或者子模板的最前面，但是由于子模板继承实现做的不是最完善，导致现在在被 extended 出来的模板中 external 必须写在模板钩子里。
另一个是最好像 GO 语言的 import 一样，对于声明了但是实际没有用到的 external 要报错或者 warning。
